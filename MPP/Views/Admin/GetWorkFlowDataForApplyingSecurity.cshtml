@model Model.WorkFlowDetailForRowLevelSecurity
<nav aria-label="breadcrumb">
    <ol class="breadcrumb rounded-3">
        <li class="breadcrumb-item">
            <a class="link-body-emphasis" href="/Home">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-door" viewBox="0 0 16 16">
                    <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4z"></path>
                </svg>
                <span class="visually-hidden">Home</span>
            </a>
        </li>
        <li class="breadcrumb-item">
            <a class="link-body-emphasis fw-semibold text-decoration-none" href="#">Apply Workflow</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            Apply Workflow
        </li>
    </ol>
</nav>
@* <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">User Details</h1>
</div> *@
<div class="card box-shadow">
    <div class="card-header">
        <h5 class="mb-0" id="lblcaption">User Details</h5>
    </div>
    <div class="card-body">
        <div class="row form-group">
            <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                <label class="editlabel">User Id</label>
                @Html.TextBoxFor(m => m.UserID, new { @id = "txtUserId", @class = "form-control" })
            </div>
            <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                <label class="editlabel">User Role</label>
                @Html.TextBoxFor(m => m.UserRole, new { @id = "txtUserRole", @class = "form-control" })
            </div>
            <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
                <label class="editlabel">Entity Id</label>
                @Html.TextBoxFor(m => m.EntityId, new { @id = "txtEntityName", @class = "form-control" })
            </div>
            <div class="col-xs-12 col-sm-5 col-md-5 col-lg-5">
                <label class="gridheader">List of Approvers</label>
                @Html.ListBoxFor(model => model.ApproverDetail,
                         new MultiSelectList(Model.ApproverDetail, "ApproverId", "ApproverName"), new { @id = "ddlApproverListBox", @class = "approverdetail form-control" })
            </div>
            <div class="col-xs-12 col-sm-2 col-md-2 col-lg-2 d-flex align-items-center justify-content-center">
                <input type="button" id="btnMoveRight" style="font-size:larger;height:30px;width:100px" value=">>" alt="Save">
                <input type="button" id="btnMoveLeft" style="font-size:larger;height:30px;width:100px" value="<<" alt="Save">
            </div>
            <div class="col-xs-12 col-sm-5 col-md-5 col-lg-5">
                <label class="gridheader">Selected Approvers</label>
                @Html.ListBoxFor(model => model.SelectedApproverDetail,
                         new MultiSelectList(Model.SelectedApproverDetail, "ApproverId", "ApproverName"), new { @id = "ddlApproverSelectedListBox", @class = "approverdetail form-control" })

            </div>
            <div class="col text-center">

                @Html.HiddenFor(x => x.SelectedApproverId, new { @id = "hdnSelectedApprover" })
                @Html.HiddenFor(x => x.RoleID, new { @id = "hdnRoleID" })
                <input type="button" id="btnSaveApprover" value="submit" class="btn btn-primary" alt="Save">
                <input type="button" id="btnCancelApprover" value="Cancel" class="btn btn-outline-primary" alt="Cancel">
            </div>
            <div class="darkBlueBg">
                @* <table style="width: 100%">
                <tr align="center" style="width:100%; height:25px">
                <td style="width: 100%;padding-left:10px" align="left">

                </td>
                </tr>
                <tr align="left" style="width:100%; height:5px">
                <td style="padding-left:10px;padding-right:10px;padding-bottom:20px" valign="top">
                <hr style="width:100%;height:2px;background-color:red;" />
                </td>
                </tr>
                </table>
                <centre>
                <table>
                <tr style="width: 100%" align="center" class="darkBlueBg">
                <td style="width: 45%;padding-left:350px">

                </td>
                <td align="left" style="width: 56%">

                </td>
                </tr>
                <tr style="width: 100%" align="center" class="darkBlueBg">
                <td style="width: 45%;padding-left:350px">

                </td>
                <td align="left" style="width: 56%">

                </td>
                </tr>
                <tr align="center" style="width: 100%" class="darkBlueBg">
                <td style="width: 45%;padding-left:350px">

                </td>
                <td align="left" style="width: 56%">

                </td>
                </tr>
                </table>
                </centre> *@
            </div>

            <div>
                <table cellpadding="0" cellspacing="0" border="0" width="100%">
                    <tr style="width:100%">
                        <td style="width:40%;padding-left:102px" rowspan="1" colspan="1">
                        </td>
                        <td style="width:20%" rowspan="1" colspan="1"></td>
                        <td style="width:40%">
                        </td>
                    </tr>
                    <tr style="width:100%">
                        <td style="width:40%" rowspan="1" colspan="1" align="right">
                        </td>
                        <td style="width:20%" align="center" rowspan="1" colspan="1">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td rowspan="1" colspan="1">
                                    </td>
                                </tr>
                                <tr>
                                    <td rowspan="1" colspan="1">
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td style="width:40%" rowspan="1" colspan="1" align="left">
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr style="width:100%">
                        <td style="width:40%"></td>
                        <td style="width:20%;padding:10px" align="center">
                        </td>
                        <td style="width:40%"></td>
                    </tr>
                    <tr>
                        <td colspan="3">
                        </td>
                    </tr>
                </table>
            </div>
            <script>
                $("#btnMoveLeft").click(function () {
                    var selectedListBoxText = [];
                    var selectedListBoxValues = [];
                    var selectedItemIndex = [];

                    var length = $("#ddlApproverSelectedListBox option:selected").length;
                    if (length > 0) {
                        for (var i = 0; i < length; i++) {
                            selectedListBoxText[i] = $("#ddlApproverSelectedListBox option:selected")[i].text;
                            selectedItemIndex[i] = $("#ddlApproverSelectedListBox option:selected")[i].index;

                            if (selectedListBoxText[i] == "--Select--") {
                                selectedListBoxValues[i] = "-1";
                            }
                            else {
                                selectedListBoxValues[i] = $("#ddlApproverSelectedListBox option:selected")[i].value;

                            }
                        }
                        for (var j = 0; j < selectedListBoxText.length; j++) {
                            var newOption = new Option(); // Create a new instance of ListItem
                            newOption.text = selectedListBoxText[j];
                            newOption.value = selectedListBoxValues[j];
                            ddlApproverListBox.options[ddlApproverListBox.length] = newOption; //Append the item in Target Listbox

                            var hdnvalue = $("#hdnSelectedApprover").val();// + "," + newOption.value;
                            hdnvalue = hdnvalue.replace(newOption.value, "");
                            $("#hdnSelectedApprover").val(hdnvalue);

                        }
                        for (var j = selectedItemIndex.length - 1; j >= 0; j--) {
                            ddlApproverSelectedListBox.remove(selectedItemIndex[j]); //Remove the item from Source Listbox
                        }
                    }
                    else {
                        alert('Please select an Item to move');
                        return false;
                    }
                });
                // To avoid user from selecting mulitple approvers at a time from the multiselect list
                $(document).ready(function () {
                    $('#ddlApproverListBox').on('change', function () {
                        var selectedOptions = $(this).find('option:selected');

                        if (selectedOptions.length > 1) {
                            selectedOptions.removeAttr('selected');

                            $(this).find('option').eq(selectedOptions[0].index).attr('selected', 'selected');
                        }
                    });
                });
                $("#btnMoveRight").click(function () {
                    var $ddlApproverListBox = $("#ddlApproverListBox");
                    var $ddlApproverSelectedListBox = $("#ddlApproverSelectedListBox");

                    // Check if there is already an option in the right list box
                    if ($ddlApproverSelectedListBox.find("option").length >= 1) {
                        alert('Only one approver can be selected at a time.');
                        return false;
                    }

                    var selectedListBoxText = [];
                    var selectedListBoxValues = [];
                    var selectedItemIndex = [];
                    var length = $("#ddlApproverListBox option:selected").length;
                    if (length > 0) {
                        for (var i = 0; i < length; i++) { 
                            selectedItemIndex[i] = $("#ddlApproverListBox option:selected")[i].index;
                            selectedListBoxText[i] = $("#ddlApproverListBox option:selected")[i].text;
                            if (selectedListBoxText[i] == "--Select--") {
                                selectedListBoxValues[i] = "-1";
                            }
                            else {
                                selectedListBoxValues[i] = $("#ddlApproverListBox option:selected")[i].value;
                            }
                        } 
                        for (var j = 0; j < selectedListBoxText.length; j++) {
                            var newOption = new Option(); // Create a new instance of ListItem
                            newOption.text = selectedListBoxText[j];
                            newOption.value = selectedListBoxValues[j];
                            var hdnvalue = $("#hdnSelectedApprover").val() + "," + newOption.value;
                            $("#hdnSelectedApprover").val(hdnvalue);

                            $ddlApproverSelectedListBox[0].options[$ddlApproverSelectedListBox[0].length] = newOption; //Append the item in Target Listbox

                        }
                        for (var j = selectedItemIndex.length - 1; j >= 0; j--) {
                            $ddlApproverListBox[0].remove(selectedItemIndex[j]); //Remove the item from Source Listbox
                        }

                    }
                    else {
                        alert('Please select an Item to move');
                        return false;
                    }
                });
                $("#btnCancelApprover").click(function () {
                    var userId = $("#txtUserId").val();

                    $.post('@Url.Action("GetAllUsers", "Admin")',
                        function (data) {
                            if (data.indexOf("error") == 0) {
                                alert(data.replace("error", ""))
                            }
                            else {

                                $('#divDisplayAllUsers').html(data);

                            }

                        });
                    $.post('@Url.Action("GetNewUserIndex", "Admin")', { newUserId: userId },
                        function (data) {
                            if (data.indexOf("error") == 0) {
                                alert(data.replace("error", ""));
                            }
                            else {
                                $('#ddlUserList')[0].selectedIndex = data;

                            }

                        });
                    $.post('@Url.Action("GetUserDetails", "Admin")', { userId: userId },
                        function (data) {
                            if (data.indexOf("error") == 0) {
                                alert(data.replace("error", ""));
                            }
                            else {

                                $('#divUserDetails').empty();

                                $('#divUserDetails').html(data);
                                $('#divEntityDetail').empty();


                            }

                        });
                });
                $("#btnSaveApprover").click(function () {
                    var hdnSelectedApprover = $("#hdnSelectedApprover").val();
                    var roleId = $("#hdnRoleID").val();
                    var userId = $("#txtUserId").val();
                    var entityName = $("#txtEntityName").val();

                    $.post('@Url.Action("SaveSelectedApprover", "Admin")', { RoleId: roleId, UserId: userId, EntityName: entityName, SelectedApproverId: hdnSelectedApprover },
                        function (data) {
                            if (data.indexOf("error") == 0) {
                                alert(data.replace("error", ""))
                            }
                            else {
                                alert(data);
                                $.post('@Url.Action("GetAllUsers", "Admin")',
                                    function (data) {
                                        if (data.indexOf("error") == 0) {
                                            alert(data.replace("error", ""))
                                        }
                                        else {

                                            $('#divDisplayAllUsers').html(data);

                                        }

                                    });
                                $.post('@Url.Action("GetNewUserIndex", "Admin")', { newUserId: userId },
                                    function (data) {
                                        if (data.indexOf("error") == 0) {
                                            alert(data.replace("error", ""));
                                        }
                                        else {
                                            $('#ddlUserList')[0].selectedIndex = data;

                                        }

                                    });
                                $.post('@Url.Action("GetUserDetails", "Admin")', { userId: userId },
                                    function (data) {
                                        if (data.indexOf("error") == 0) {
                                            alert(data.replace("error", ""));
                                        }
                                        else {

                                            $('#divUserDetails').empty();

                                            $('#divUserDetails').html(data);
                                            $('#divEntityDetail').empty();


                                        }

                                    });
                            }

                        });

                });
            </script>
            <style type="text/css">
                /* .approverdetail
                                                                                                {
                                                                                                    width:300px;
                                                                                                    height:150px;
                                                                                                    font-family:Verdana;
                                                                                                }
                                                                                                .selectedapprover
                                                                                                {
                                                                                                    width:150px;
                                                                                                    font-family:Verdana;
                                                                                                    width:300px;
                                                                                                } */
            </style>
